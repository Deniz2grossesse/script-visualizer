<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <title>Network Rules Generator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
      }

      .info-box {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
        color: #495057;
      }

      .mandatory {
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #495057;
      }

      .required {
        color: red;
      }

      input[type="text"],
      input[type="email"],
      input[type="number"],
      select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        box-sizing: border-box;
        margin-bottom: 10px;
      }

      .rules-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        background-color: #f8f9fa;
      }

      .add-button {
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 10px;
      }

      .add-button:hover {
        background-color: #218838;
      }

      .action-buttons {
        margin-top: 20px;
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .btn-delete {
        background-color: #dc3545;
        color: white;
      }

      .btn-delete:hover {
        background-color: #c82333;
      }

      .btn-resume {
        background-color: #17a2b8;
        color: white;
      }

      .btn-resume:hover {
        background-color: #138496;
      }

      .btn-verify {
        background-color: #ffc107;
        color: #212529;
      }

      .btn-verify:hover {
        background-color: #e0a800;
      }

      .btn-validate {
        background-color: #28a745;
        color: white;
      }

      .btn-validate:hover {
        background-color: #218838;
      }

      .btn-generate {
        background-color: #007bff;
        color: white;
      }

      .btn-generate:hover {
        background-color: #0056b3;
      }

      .output {
        margin-top: 30px;
        display: none;
      }

      .script-block {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        margin-bottom: 15px;
        padding: 15px;
      }

      .script-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .script-output {
        width: 100%;
        height: 150px;
        padding: 10px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        background-color: #fff;
        font-family: monospace;
        resize: vertical;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>One Click Onboarding</h1>

      <div class="top-buttons">
        <button class="btn-add" onclick="addNewLine()">
          <span>+</span>
          Ajouter une ligne
        </button>
        <button class="btn-import" onclick="importCSV()">
          <span>‚Üì</span>
          Importer CSV
        </button>
      </div>

      <table id="rulesTable" class="rules-table" style="display: none;">
        <thead>
          <tr>
            <th>Source IP</th>
            <th>IP Destination</th>
            <th>Protocol</th>
            <th>Service</th>
            <th>Port</th>
            <th>Authentication</th>
            <th>Flow Encryption</th>
            <th>Classification</th>
            <th>APP Code</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="loadingMessage" class="loading-message">
        Fichier en cours de chargement...
      </div>
    </div>

    <script>
      let currentRules = [];

      function showLoading() {
        document.getElementById('loadingMessage').style.display = 'block';
      }

      function hideLoading() {
        document.getElementById('loadingMessage').style.display = 'none';
      }

      function importCSV() {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.csv';

        fileInput.onchange = (event) => {
          const file = (event.target ).files[0];
          if (file) {
            showLoading();
            const reader = new FileReader();
            reader.onload = function(event) {
              const csvData = event.target.result;
              processCSV(csvData);
            };
            reader.onerror = function() {
              alert('Erreur lors de la lecture du fichier.');
              hideLoading();
            };
            reader.readAsText(file);
          }
        };

        fileInput.click();
      }

      function processCSV(csvData) {
        const lines = csvData.split('\n');
        const headers = lines[0].split(',');
        currentRules = [];

        for (let i = 1; i < lines.length; i++) {
          const data = lines[i].split(',');
          if (data.length === headers.length) {
            const rule = {
              sourceIP: data[0],
              destIP: data[1],
              protocol: data[2],
              service: data[3],
              port: data[4],
              authentication: data[5],
              flowEncryption: data[6],
              classification: data[7],
              appCode: data[8]
            };
            currentRules.push(rule);
          }
        }

        hideLoading();
        displayRules();
      }

      function displayRules() {
        const table = document.getElementById('rulesTable');
        const tbody = table.querySelector('tbody');
        tbody.innerHTML = '';
        
        currentRules.forEach((rule, index) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><input type="text" value="${rule.sourceIP}" onchange="updateRule(${index}, 'sourceIP', this.value)"></td>
            <td><input type="text" value="${rule.destIP}" onchange="updateRule(${index}, 'destIP', this.value)"></td>
            <td>
              <select onchange="updateRule(${index}, 'protocol', this.value)">
                <option value="TCP" ${rule.protocol === 'TCP' ? 'selected' : ''}>TCP</option>
                <option value="UDP" ${rule.protocol === 'UDP' ? 'selected' : ''}>UDP</option>
                <option value="ICMP" ${rule.protocol === 'ICMP' ? 'selected' : ''}>ICMP</option>
              </select>
            </td>
            <td><input type="text" value="${rule.service}" onchange="updateRule(${index}, 'service', this.value)"></td>
            <td><input type="text" value="${rule.port}" onchange="updateRule(${index}, 'port', this.value)"></td>
            <td>
              <select onchange="updateRule(${index}, 'authentication', this.value)">
                <option value="Yes" ${rule.authentication === 'Yes' ? 'selected' : ''}>Yes</option>
                <option value="No" ${rule.authentication === 'No' ? 'selected' : ''}>No</option>
              </select>
            </td>
            <td>
              <select onchange="updateRule(${index}, 'flowEncryption', this.value)">
                <option value="Yes" ${rule.flowEncryption === 'Yes' ? 'selected' : ''}>Yes</option>
                <option value="No" ${rule.flowEncryption === 'No' ? 'selected' : ''}>No</option>
              </select>
            </td>
            <td>
              <select onchange="updateRule(${index}, 'classification', this.value)">
                <option value="Yellow" ${rule.classification === 'Yellow' ? 'selected' : ''}>Yellow</option>
                <option value="Amber" ${rule.classification === 'Amber' ? 'selected' : ''}>Amber</option>
                <option value="Red" ${rule.classification === 'Red' ? 'selected' : ''}>Red</option>
              </select>
            </td>
            <td><input type="text" value="${rule.appCode}" onchange="updateRule(${index}, 'appCode', this.value)"></td>
            <td>
              <button class="delete-btn" onclick="deleteRule(${index})">
                <span class="trash-icon">üóëÔ∏è</span>
              </button>
            </td>
          `;
          tbody.appendChild(tr);
        });
        
        table.style.display = 'table';
      }

      function deleteRule(index) {
        if (confirm('Voulez-vous vraiment supprimer cette ligne ?')) {
          currentRules.splice(index, 1);
          displayRules();
        }
      }

      function updateRule(index, key, value) {
        currentRules[index][key] = value;
      }

      function addNewLine() {
        const newRule = {
          sourceIP: '',
          destIP: '',
          protocol: 'TCP',
          service: '',
          port: '',
          authentication: 'Yes',
          flowEncryption: 'Yes',
          classification: 'Yellow',
          appCode: ''
        };
        currentRules.push(newRule);
        displayRules();
      }
    </script>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
      }

      .top-buttons {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
      }

      .btn-add, .btn-import {
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 16px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .btn-add:hover, .btn-import:hover {
        background-color: #0056b3;
      }

      .rules-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }

      .rules-table th, .rules-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      .rules-table th {
        background-color: #f2f2f2;
      }

      .rules-table input[type="text"], .rules-table select {
        width: 100%;
        padding: 6px;
        box-sizing: border-box;
        margin-bottom: 5px;
      }

      .loading-message {
        display: none;
        text-align: center;
        margin-top: 20px;
        font-style: italic;
        color: #666;
      }

      .delete-btn {
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
      }

      .delete-btn:hover {
        background-color: #c82333;
      }

      .trash-icon {
        font-size: 16px;
      }
    </style>
  </body>
</html>
