<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>One Click Onboarding</title>
    <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
  color: #333;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  padding: 40px;
}

h1 {
  text-align: center;
  color: #2c3e50;
  margin-bottom: 30px;
  font-size: 2.5rem;
  font-weight: 700;
}

.warning-message {
  background: linear-gradient(45deg, #ff6b6b, #feca57);
  color: white;
  padding: 15px 20px;
  border-radius: 10px;
  margin-bottom: 30px;
  text-align: center;
  font-weight: 500;
}

.form-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
  padding: 25px;
  background: #f8f9fa;
  border-radius: 15px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #2c3e50;
}

.form-group input, .form-group select, .form-group textarea {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e1e8ed;
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.3s ease;
  background: white;
}

.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.rule {
  background: white;
  border: 2px solid #e1e8ed;
  border-radius: 15px;
  padding: 25px;
  margin-bottom: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  align-items: end;
  transition: all 0.3s ease;
  position: relative;
}

.rule:hover {
  border-color: #667eea;
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
}

.rule.duplicate-row {
  border-color: #ff6b6b;
  background: #fff5f5;
}

.duplicate-warning {
  grid-column: 1 / -1;
  color: #e74c3c;
  font-weight: bold;
  text-align: center;
  padding: 10px;
  background: #ffebee;
  border-radius: 5px;
  margin-top: 10px;
}

.ip-textarea {
  resize: vertical;
  min-height: 40px;
  font-family: monospace;
}

.form-actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.icon-btn {
  width: 40px;
  height: 40px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.duplicate-btn {
  background: #e3f2fd;
  color: #1976d2;
}

.duplicate-btn:hover {
  background: #bbdefb;
  transform: translateY(-2px);
}

.delete-btn {
  background: #ffebee;
  color: #d32f2f;
}

.delete-btn:hover {
  background: #ffcdd2;
  transform: translateY(-2px);
}

.button-row {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
  margin: 30px 0;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 25px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  min-width: 120px;
  justify-content: center;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.btn-primary {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
}

.btn-success {
  background: linear-gradient(45deg, #56ab2f, #a8e6cf);
  color: white;
}

.btn-warning {
  background: linear-gradient(45deg, #f093fb, #f5576c);
  color: white;
}

.btn-danger {
  background: linear-gradient(45deg, #ff6b6b, #ee5a24);
  color: white;
}

.btn-secondary {
  background: linear-gradient(45deg, #74b9ff, #0984e3);
  color: white;
}

.icon {
  font-size: 16px;
  font-weight: bold;
}

#output {
  margin-top: 30px;
}

.script-block {
  background: white;
  border: 2px solid #e1e8ed;
  border-radius: 15px;
  margin-bottom: 20px;
  overflow: hidden;
}

.script-header {
  background: linear-gradient(45deg, #2c3e50, #3498db);
  color: white;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
}

.copy-btn {
  background: rgba(255,255,255,0.2);
  color: white;
  border: 1px solid rgba(255,255,255,0.3);
  padding: 5px 15px;
  border-radius: 15px;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.3s ease;
}

.copy-btn:hover {
  background: rgba(255,255,255,0.3);
}

.script-output {
  width: 100%;
  height: 200px;
  padding: 20px;
  border: none;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 12px;
  line-height: 1.5;
  background: #f8f9fa;
  resize: vertical;
  color: #2c3e50;
}

/* Credentials Dialog Styles */
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.dialog-content {
  background: white;
  border-radius: 15px;
  padding: 30px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}

.dialog-content h3 {
  color: #2c3e50;
  margin-bottom: 10px;
  text-align: center;
}

.dialog-content p {
  color: #667eea;
  margin-bottom: 20px;
  text-align: center;
  font-weight: 600;
}

.dialog-buttons {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    padding: 20px;
  }
  
  .rule {
    grid-template-columns: 1fr;
  }
  
  .form-section {
    grid-template-columns: 1fr;
  }
  
  .button-row {
    flex-direction: column;
    align-items: center;
  }
  
  .btn {
    width: 100%;
    max-width: 200px;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 2rem;
  }
  
  .container {
    padding: 15px;
  }
}
    </style>
  </head>
  <body>
    <div class="container">
      <h1>One Click Onboarding</h1>
      
      <div class="warning-message">
        <strong>⚠️ Important:</strong> These three fields are mandatory, you cannot start entering them without having filled them in.
      </div>

      <div class="form-section">
        <div class="form-group">
          <label for="department">Department *</label>
          <input type="text" id="department" maxlength="4" placeholder="Department (1-4 chars)">
        </div>

        <div class="form-group">
          <label for="projectCode">Project/Application Code *</label>
          <input type="text" id="projectCode" maxlength="4" placeholder="Project code (1-4 chars)">
        </div>

        <div class="form-group">
          <label for="email">Requester's Email *</label>
          <input type="email" id="email" placeholder="Email address">
        </div>
      </div>

      <div class="button-row">
        <button onclick="addRule()" class="btn btn-primary">
          <span class="icon">+</span> Add Rule
        </button>
      </div>

      <div id="rulesContainer"></div>

      <div class="button-row">
        <button onclick="deleteRules()" class="btn btn-danger">Delete</button>
        <button onclick="resumeDraft()" class="btn btn-secondary">Resume Draft</button>
        <button onclick="saveDraft()" class="btn btn-secondary">Save Draft</button>
        <button onclick="verifyRules()" class="btn btn-warning">Verify</button>
        <button onclick="generateScripts()" class="btn btn-success">
          Generate Scripts <span class="icon">→</span>
        </button>
      </div>

      <div id="output" style="display: none;"></div>
    </div>

    <!-- Credentials Dialog -->
    <div id="credentialsDialog" class="dialog-overlay" style="display: none;">
      <div class="dialog-content">
        <h3>Authentication Required</h3>
        <p>Please enter your credentials TA-I0034</p>
        
        <div class="form-group">
          <label for="username">Username:</label>
          <input type="text" id="username" placeholder="Enter username">
        </div>
        
        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" id="password" placeholder="Enter password">
        </div>
        
        <div class="dialog-buttons">
          <button onclick="hideCredentialsDialog()" class="btn btn-secondary">Cancel</button>
          <button onclick="submitCredentials()" class="btn btn-primary">Generate Scripts</button>
        </div>
      </div>
    </div>

    <script>
let ruleCounter = 0;
let savedData = null;

// Function to add a new rule
function addRule() {
  const department = document.getElementById('department').value.trim();
  const projectCode = document.getElementById('projectCode').value.trim();
  const email = document.getElementById('email').value.trim();

  if (!department || !projectCode || !email) {
    alert('Please fill in all mandatory fields (Department, Project Code, and Email) before adding rules.');
    return;
  }

  ruleCounter++;
  const container = document.getElementById('rulesContainer');
  
  const ruleDiv = document.createElement('div');
  ruleDiv.className = 'rule';
  ruleDiv.id = `rule-${ruleCounter}`;
  
  ruleDiv.innerHTML = `
    <div class="form-group">
      <label for="source-ip-${ruleCounter}">Source IP(s) *</label>
      <textarea id="source-ip-${ruleCounter}" class="ip-textarea" placeholder="192.168.1.1 or 192.168.1.0/24 (one per line)" required></textarea>
    </div>

    <div class="form-group">
      <label for="dest-ip-${ruleCounter}">Destination IP(s) *</label>
      <textarea id="dest-ip-${ruleCounter}" class="ip-textarea" placeholder="10.0.0.1 or 10.0.0.0/24 (one per line)" required></textarea>
    </div>

    <div class="form-group">
      <label for="service-${ruleCounter}">Service *</label>
      <select id="service-${ruleCounter}" required>
        <option value="">Select Service</option>
        <option value="HTTP">HTTP</option>
        <option value="HTTPS">HTTPS</option>
        <option value="SSH">SSH</option>
        <option value="FTP">FTP</option>
        <option value="SMTP">SMTP</option>
        <option value="DNS">DNS</option>
        <option value="Custom">Custom</option>
      </select>
    </div>

    <div class="form-group">
      <label for="port-${ruleCounter}">Port(s)</label>
      <input type="text" id="port-${ruleCounter}" placeholder="80, 443, 22-25">
    </div>

    <div class="form-group">
      <label for="action-${ruleCounter}">Action *</label>
      <select id="action-${ruleCounter}" required>
        <option value="">Select Action</option>
        <option value="permit">Permit</option>
        <option value="deny">Deny</option>
      </select>
    </div>

    <div class="form-group">
      <label for="justification-${ruleCounter}">Justification *</label>
      <textarea id="justification-${ruleCounter}" placeholder="Business justification for this rule" required></textarea>
    </div>

    <div class="form-actions">
      <button type="button" class="icon-btn duplicate-btn" onclick="duplicateRule(${ruleCounter})" title="Duplicate Rule">
        📋
      </button>
      <button type="button" class="icon-btn delete-btn" onclick="deleteRule(${ruleCounter})" title="Delete Rule">
        🗑️
      </button>
    </div>
  `;
  
  container.appendChild(ruleDiv);
  updateRuleValidation();
}

// Function to duplicate a rule
function duplicateRule(ruleId) {
  const originalRule = document.getElementById(`rule-${ruleId}`);
  if (!originalRule) return;

  ruleCounter++;
  const container = document.getElementById('rulesContainer');
  
  const newRule = originalRule.cloneNode(true);
  newRule.id = `rule-${ruleCounter}`;
  
  // Update all IDs and onclick handlers in the cloned rule
  const elements = newRule.querySelectorAll('[id]');
  elements.forEach(element => {
    const oldId = element.id;
    const newId = oldId.replace(`-${ruleId}`, `-${ruleCounter}`);
    element.id = newId;
    
    // Update corresponding labels
    const label = newRule.querySelector(`label[for="${oldId}"]`);
    if (label) {
      label.setAttribute('for', newId);
    }
  });
  
  // Update button onclick handlers
  const duplicateBtn = newRule.querySelector('.duplicate-btn');
  const deleteBtn = newRule.querySelector('.delete-btn');
  
  if (duplicateBtn) {
    duplicateBtn.setAttribute('onclick', `duplicateRule(${ruleCounter})`);
  }
  if (deleteBtn) {
    deleteBtn.setAttribute('onclick', `deleteRule(${ruleCounter})`);
  }
  
  container.appendChild(newRule);
  updateRuleValidation();
}

// Function to delete a specific rule
function deleteRule(ruleId) {
  const rule = document.getElementById(`rule-${ruleId}`);
  if (rule) {
    rule.remove();
    updateRuleValidation();
  }
}

// Function to delete all rules
function deleteRules() {
  if (confirm('Are you sure you want to delete all rules?')) {
    document.getElementById('rulesContainer').innerHTML = '';
    updateRuleValidation();
  }
}

// Function to update rule validation and check for duplicates
function updateRuleValidation() {
  const rules = document.querySelectorAll('.rule');
  const ruleData = [];
  
  rules.forEach(rule => {
    const sourceIp = rule.querySelector('[id^="source-ip-"]').value.trim();
    const destIp = rule.querySelector('[id^="dest-ip-"]').value.trim();
    const service = rule.querySelector('[id^="service-"]').value;
    const port = rule.querySelector('[id^="port-"]').value.trim();
    const action = rule.querySelector('[id^="action-"]').value;
    
    const ruleKey = `${sourceIp}|${destIp}|${service}|${port}|${action}`;
    ruleData.push({ element: rule, key: ruleKey });
  });
  
  // Check for duplicates
  const duplicateKeys = new Set();
  const keyCount = {};
  
  ruleData.forEach(({ key }) => {
    keyCount[key] = (keyCount[key] || 0) + 1;
    if (keyCount[key] > 1) {
      duplicateKeys.add(key);
    }
  });
  
  // Update UI for duplicates
  ruleData.forEach(({ element, key }) => {
    const existingWarning = element.querySelector('.duplicate-warning');
    if (existingWarning) {
      existingWarning.remove();
    }
    
    if (duplicateKeys.has(key) && key !== '||||') {
      element.classList.add('duplicate-row');
      const warning = document.createElement('div');
      warning.className = 'duplicate-warning';
      warning.textContent = '⚠️ This rule appears to be a duplicate';
      element.appendChild(warning);
    } else {
      element.classList.remove('duplicate-row');
    }
  });
}

// Function to collect all rule data
function collectRuleData() {
  const rules = document.querySelectorAll('.rule');
  const csvRows = [];
  
  rules.forEach((rule, index) => {
    const sourceIp = rule.querySelector('[id^="source-ip-"]').value.trim();
    const destIp = rule.querySelector('[id^="dest-ip-"]').value.trim();
    const service = rule.querySelector('[id^="service-"]').value;
    const port = rule.querySelector('[id^="port-"]').value.trim();
    const action = rule.querySelector('[id^="action-"]').value;
    const justification = rule.querySelector('[id^="justification-"]').value.trim();
    
    if (sourceIp && destIp && service && action && justification) {
      csvRows.push([
        sourceIp,
        destIp,
        service,
        port || 'any',
        action,
        justification
      ]);
    }
  });
  
  return csvRows;
}

// Function to verify rules
function verifyRules() {
  const department = document.getElementById('department').value.trim();
  const projectCode = document.getElementById('projectCode').value.trim();
  const email = document.getElementById('email').value.trim();
  
  if (!department || !projectCode || !email) {
    alert('Please fill in all mandatory fields before verifying.');
    return;
  }
  
  const csvRows = collectRuleData();
  if (csvRows.length === 0) {
    alert('Please add at least one complete rule before verifying.');
    return;
  }
  
  // Simple verification - check for required fields
  let isValid = true;
  let errorMessages = [];
  
  if (department.length > 4) {
    errorMessages.push('Department code must be 4 characters or less');
    isValid = false;
  }
  
  if (projectCode.length > 4) {
    errorMessages.push('Project code must be 4 characters or less');
    isValid = false;
  }
  
  if (!email.includes('@')) {
    errorMessages.push('Please enter a valid email address');
    isValid = false;
  }
  
  if (isValid) {
    alert(`Verification successful!\n\nDepartment: ${department}\nProject: ${projectCode}\nEmail: ${email}\nRules: ${csvRows.length}`);
  } else {
    alert('Verification failed:\n\n' + errorMessages.join('\n'));
  }
}

// Function to save draft
function saveDraft() {
  const data = {
    department: document.getElementById('department').value,
    projectCode: document.getElementById('projectCode').value,
    email: document.getElementById('email').value,
    rules: collectRuleData(),
    timestamp: new Date().toISOString()
  };
  
  savedData = data;
  localStorage.setItem('onboardingDraft', JSON.stringify(data));
  alert('Draft saved successfully!');
}

// Function to resume draft
function resumeDraft() {
  const saved = localStorage.getItem('onboardingDraft');
  if (!saved) {
    alert('No saved draft found.');
    return;
  }
  
  try {
    const data = JSON.parse(saved);
    
    // Restore form fields
    document.getElementById('department').value = data.department || '';
    document.getElementById('projectCode').value = data.projectCode || '';
    document.getElementById('email').value = data.email || '';
    
    // Clear existing rules
    document.getElementById('rulesContainer').innerHTML = '';
    ruleCounter = 0;
    
    // Restore rules
    if (data.rules && data.rules.length > 0) {
      data.rules.forEach(rule => {
        addRule();
        const currentRule = document.getElementById(`rule-${ruleCounter}`);
        if (currentRule) {
          currentRule.querySelector('[id^="source-ip-"]').value = rule[0] || '';
          currentRule.querySelector('[id^="dest-ip-"]').value = rule[1] || '';
          currentRule.querySelector('[id^="service-"]').value = rule[2] || '';
          currentRule.querySelector('[id^="port-"]').value = rule[3] === 'any' ? '' : rule[3] || '';
          currentRule.querySelector('[id^="action-"]').value = rule[4] || '';
          currentRule.querySelector('[id^="justification-"]').value = rule[5] || '';
        }
      });
    }
    
    alert(`Draft restored successfully!\nSaved: ${new Date(data.timestamp).toLocaleString()}`);
  } catch (error) {
    alert('Error loading draft: ' + error.message);
  }
}

// Function to show credentials dialog
function generateScripts() {
  const department = document.getElementById('department').value.trim();
  const projectCode = document.getElementById('projectCode').value.trim();
  const email = document.getElementById('email').value.trim();
  
  if (!department || !projectCode || !email) {
    alert('Please fill in all mandatory fields before generating scripts.');
    return;
  }
  
  const csvRows = collectRuleData();
  if (csvRows.length === 0) {
    alert('Please add at least one complete rule before generating scripts.');
    return;
  }
  
  showCredentialsDialog();
}

// Function to show credentials dialog
function showCredentialsDialog() {
  document.getElementById('credentialsDialog').style.display = 'flex';
  document.getElementById('username').focus();
}

// Function to hide credentials dialog
function hideCredentialsDialog() {
  document.getElementById('credentialsDialog').style.display = 'none';
  document.getElementById('username').value = '';
  document.getElementById('password').value = '';
}

// Function to submit credentials and generate scripts
function submitCredentials() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  
  if (!username || !password) {
    alert('Please enter both username and password.');
    return;
  }
  
  const csvRows = collectRuleData();
  
  // Hide dialog
  hideCredentialsDialog();
  
  // Show loading message
  const outputDiv = document.getElementById('output');
  outputDiv.style.display = 'block';
  outputDiv.innerHTML = '<div style="text-align: center; padding: 20px;">Generating scripts...</div>';
  
  // Simulate calling Google Apps Script function
  // In real Google Apps Script environment, this would be:
  // google.script.run.withSuccessHandler(displayScripts).generatePythonScripts(csvRows, username, password);
  
  // For this demo, we'll simulate the response
  setTimeout(() => {
    const mockScripts = [
      {
        name: 'Checkpoint Script',
        content: `# Checkpoint Firewall Script\n# Generated for rules\n\n${csvRows.map((row, i) => 
          `# Rule ${i + 1}: ${row[0]} -> ${row[1]} (${row[2]}:${row[3]}) - ${row[4]}\necho "Processing rule ${i + 1}"`
        ).join('\n')}`
      },
      {
        name: 'Palo Alto Script',
        content: `# Palo Alto Firewall Script\n# Generated for rules\n\n${csvRows.map((row, i) => 
          `# Rule ${i + 1}: ${row[0]} -> ${row[1]} (${row[2]}:${row[3]}) - ${row[4]}\necho "Configuring rule ${i + 1}"`
        ).join('\n')}`
      }
    ];
    
    displayScripts(mockScripts);
  }, 2000);
}

// Function to display generated scripts
function displayScripts(scripts) {
  const outputDiv = document.getElementById('output');
  
  let html = '<h2>Generated Scripts</h2>';
  
  scripts.forEach((script, index) => {
    html += `
      <div class="script-block">
        <div class="script-header">
          <span>${script.name}</span>
          <button class="copy-btn" onclick="copyScript(${index})">Copy</button>
        </div>
        <textarea class="script-output" id="script-${index}" readonly>${script.content}</textarea>
      </div>
    `;
  });
  
  html += `
    <div class="button-row">
      <button onclick="clearOutput()" class="btn btn-secondary">Clear Output</button>
    </div>
  `;
  
  outputDiv.innerHTML = html;
}

// Function to copy script to clipboard
function copyScript(index) {
  const textarea = document.getElementById(`script-${index}`);
  textarea.select();
  document.execCommand('copy');
  
  const button = event.target;
  const originalText = button.textContent;
  button.textContent = 'Copied!';
  setTimeout(() => {
    button.textContent = originalText;
  }, 2000);
}

// Function to clear output
function clearOutput() {
  document.getElementById('output').style.display = 'none';
}

// Add event listeners for real-time validation
document.addEventListener('DOMContentLoaded', function() {
  // Add change listeners to form inputs for validation
  document.addEventListener('change', function(e) {
    if (e.target.closest('.rule')) {
      updateRuleValidation();
    }
  });
  
  // Add input listeners for character limits
  const departmentInput = document.getElementById('department');
  const projectCodeInput = document.getElementById('projectCode');
  
  [departmentInput, projectCodeInput].forEach(input => {
    if (input) {
      input.addEventListener('input', function() {
        if (this.value.length > 4) {
          this.value = this.value.substring(0, 4);
        }
      });
    }
  });
  
  // Handle Enter key in credentials dialog
  document.getElementById('credentialsDialog').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      submitCredentials();
    }
  });
});
    </script>
  </body>
</html>
